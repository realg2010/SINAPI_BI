SUBROUTINE JSL.TOPS.XTR.CATEGORY.M
$INSERT I_COMMON
$INSERT I_EQUATE
$INSERT I_F.CATEGORY
$INSERT I_F.DATES

GOSUB INIT
GOSUB PROCESS
RETURN

INIT:
   FN.CAT='F.CATEGORY'
   F.CAT=''
   CALL OPF(FN.CAT,F.CAT)
   OPEN "","/u01/tafj/TAFJ/UD/TOPS.BP" TO F.ACL.CONTIF ELSE PRINT "CAN NOT OPEN DIRECTORY"
   DLM='|'
   REPORT.DATE=R.DATES(EB.DAT.LAST.WORKING.DAY)[1,4]:'-':R.DATES(EB.DAT.LAST.WORKING.DAY)[5,2]:'-':R.DATES(EB.DAT.LAST.WORKING.DAY)[7,2]
   DB.DATE=TODAY[1,4]:'-':TODAY[5,2]:'-':TODAY[7,2]
RETURN

PROCESS:
     CAT.CMD='SSELECT ':FN.CAT
	 CALL EB.READLIST(CAT.CMD,CAT.LIST,'','','')
	 LOOP
	 REMOVE CAT.ID FROM CAT.LIST SETTING CAT.POS
	 WHILE CAT.ID:CAT.POS
	 CALL F.READ(FN.CAT,CAT.ID,R.CAT,F.CAT,CAT.ERR)
	 DESC=R.CAT<EB.CAT.DESCRIPTION,1>
	 S.N=R.CAT<EB.CAT.SHORT.NAME,1>
	 S.I=R.CAT<EB.CAT.SYSTEM.IND>
	 MNE=R.CAT<EB.CAT.MNEMONIC>
	 CHANGE ',' TO ' ' IN DESC
	 CHANGE ',' TO ' ' IN S.N
	 OUT.ARR=CAT.ID:DLM:DQUOTE(DESC):DLM:DQUOTE(S.N):DLM:S.I:DLM:MNE:DLM:REPORT.DATE:DLM:DB.DATE
	 PY.LIST<-1>=OUT.ARR
	 OUT.ARR='' ; S.N='' ; S.I='' ; DESC=''
	 REPEAT
	 CHANGE '"' TO '' IN PY.LIST
     WRITE PY.LIST TO F.ACL.CONTIF,'CAT.REP.-':DB.DATE:"-.csv"
	 PY.LIST=''
RETURN
END