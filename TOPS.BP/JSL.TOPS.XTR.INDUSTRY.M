SUBROUTINE JSL.TOPS.XTR.INDUSTRY.M
$INSERT I_COMMON
$INSERT I_EQUATE
$INSERT I_F.INDUSTRY
$INSERT I_F.DATES

GOSUB INIT
GOSUB PROCESS
RETURN

INIT:
   FN.IND='F.INDUSTRY'
   F.IND=''
   CALL OPF(FN.IND,F.IND)
   OPEN "","/u01/tafj/TAFJ/UD/TOPS.BP" TO F.ACL.CONTIF ELSE PRINT "CAN NOT OPEN DIRECTORY"
   DLM='|'
   CALL GET.LOC.REF('INDUSTRY','IND.SECT',I.POS)
   REPORT.DATE=R.DATES(EB.DAT.LAST.WORKING.DAY)[1,4]:'-':R.DATES(EB.DAT.LAST.WORKING.DAY)[5,2]:'-':R.DATES(EB.DAT.LAST.WORKING.DAY)[7,2]
   DB.DATE=TODAY[1,4]:'-':TODAY[5,2]:'-':TODAY[7,2]
RETURN

PROCESS:
     IND.CMD='SSELECT ':FN.IND
	 CALL EB.READLIST(IND.CMD,IND.LIST,'','','')
	 LOOP
	 REMOVE IND.ID FROM IND.LIST SETTING IND.POS
	 WHILE IND.ID:IND.POS
	 CALL F.READ(FN.IND,IND.ID,R.IND,F.IND,IND.ERR)
	 DESC=R.IND<EB.IND.DESCRIPTION,1>
	 H.R=R.IND<EB.IND.HIGH.RISK>
	 I.D=R.IND<EB.IND.LOCAL.REF,I.POS>
	 CHANGE ',' TO ' ' IN DESC
	 CHANGE ',' TO ' ' IN H.R
	 OUT.ARR=IND.ID:DLM:DQUOTE(DESC):DLM:DQUOTE(H.R):DLM:I.D:DLM:REPORT.DATE:DLM:DB.DATE
	 PY.LIST<-1>=OUT.ARR
	 OUT.ARR='' ; I.D='' ; H.R='' ; DESC=''
	 REPEAT
	 CHANGE '"' TO '' IN PY.LIST
     WRITE PY.LIST TO F.ACL.CONTIF,'IND.REP.-':DB.DATE:"-.csv"
     PY.LIST=''
RETURN
END